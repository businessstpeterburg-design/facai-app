import asyncio
import sqlite3
import random
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import WebAppInfo, InlineKeyboardButton, InlineKeyboardMarkup

# ВСТАВЬ СВОЙ ТОКЕН НИЖЕ
TOKEN = "8429740565:AAGqSQSwCrAEk8YO1mqJLUtYsBMLNimeTwI"

bot = Bot(token=TOKEN)
dp = Dispatcher()

# Инициализация БД для хранения истории предсказаний
def init_db():
    conn = sqlite3.connect('oracle.db')
    cursor = conn.cursor()
    cursor.execute('''CREATE TABLE IF NOT EXISTS history 
                      (user_id INTEGER, pred_id INTEGER)''')
    conn.commit()
    conn.close()

# База из 100 глубоких предсказаний (пример структуры)
PREDICTIONS = [
    {"id": 1, "text": "Сегодня великий Золотой Дракон направляет твой взор внутрь себя. Твой Поток (Flow) требует не усилий, а тишины. Вселенная советует тебе на время отложить меч и заняться восстановлением духа: проведи время с близкими, ведь они — твой истинный якорь в бурном океане цифровой эры. Не позволяй мелким тревогам нарушить твою внутреннюю гармонию. Будь подобен воде — она обтекает препятствия, не теряя своей силы. Сегодня удача не стучит в дверь, она ждет тебя в моменте спокойствия. Используй этот день, чтобы испытать то, что раньше казалось невозможным — начни новое, смени маршрут, доверься интуиции. Твоя вера в успех — это и есть сам успех. Всё получится, ибо печать процветания уже отмечена в твоем коде судьбы..."},
    # Здесь добавляются остальные 99 предсказаний в таком же стиле
]

def get_unique_prediction(user_id):
    conn = sqlite3.connect('oracle.db')
    cursor = conn.cursor()
    cursor.execute("SELECT pred_id FROM history WHERE user_id = ?", (user_id,))
    seen_ids = [row[0] for row in cursor.fetchall()]
    
    available = [p for p in PREDICTIONS if p['id'] not in seen_ids]
    if not available: # Если всё посмотрел, обнуляем цикл
        cursor.execute("DELETE FROM history WHERE user_id = ?", (user_id,))
        available = PREDICTIONS
    
    chosen = random.choice(available)
    cursor.execute("INSERT INTO history VALUES (?, ?)", (user_id, chosen['id']))
    conn.commit()
    conn.close()
    return chosen['text']

@dp.message(Command("start"))
async def start(message: types.Message):
    init_db()
    markup = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="⛩ ВОЙТИ В ХРАМ ⛩", web_app=WebAppInfo(url="ТВОЯ_ССЫЛКА_НА_ГИТХАБ_ИЛИ_СЕРВЕР"))]
    ])
    await message.answer_photo(
        photo="https://твой-хост.com/dragon.jpg", 
        caption=f"Приветствую, {message.from_user.first_name}!\n\nДракон ждет тебя. Готов ли ты познать свой Поток?",
        reply_markup=markup
    )

async def main():
    await dp.start_polling(bot)

if __name__ == '__main__':
    asyncio.run(main())
    <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dragon Oracle 2026 AAA+</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Cinzel', serif; color: gold; }
        #canvas-container { position: fixed; top: 0; left: 0; z-index: 1; }
        
        /* Слой UI */
        #ui-layer { position: relative; z-index: 10; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 20px; pointer-events: none; }
        .btn { pointer-events: auto; background: rgba(255, 215, 0, 0.1); border: 1px solid gold; padding: 15px 40px; border-radius: 30px; color: gold; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; backdrop-filter: blur(5px); transition: 0.3s; box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); }
        .btn:active { transform: scale(0.95); background: gold; color: black; }

        /* Папирус */
        #scroll-container { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 90%; max-height: 80vh; background: url('https://твой-хост.com/paper_texture.jpg');
            background-size: cover; z-index: 100; border-radius: 5px; padding: 30px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8); display: none; overflow-y: auto;
        }
        #scroll-text { color: #3d2b1f; font-family: 'Courier New', serif; line-height: 1.6; font-size: 1.1rem; }
        #seal { width: 100px; display: block; margin: 20px auto 0; opacity: 0; transform: scale(3); }

        /* Монеты */
        .coin-effect { position: fixed; pointer-events: none; z-index: 99; }
    </style>
</head>
<body>

<div id="canvas-container"></div>

<div id="ui-layer">
    <div id="hud">
        <div style="font-size: 0.8rem; opacity: 0.7;">QUANTUM ENERGY</div>
        <div id="qk-val" style="font-size: 2rem; text-shadow: 0 0 10px gold;">888.88</div>
    </div>

    <button class="btn" onclick="startRitual()">ЗАПУСТИТЬ КОЛЕСО</button>
</div>

<div id="scroll-container">
    <div id="scroll-text"></div>
    <img src="royalSeal.jpg" id="seal">
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // Звуки
    const zenMusic = new Audio('zen.mp3');
    const coinSound = new Audio('coin.mp3');
    zenMusic.loop = true;

    // 3D Scene Setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    // Добавление Дракона (Texture Layer)
    const loader = new THREE.TextureLoader();
    const dragonTex = loader.load('dragon.jpg');
    const dragonMat = new THREE.SpriteMaterial({ map: dragonTex, transparent: true, opacity: 0.8 });
    const dragon = new THREE.Sprite(dragonMat);
    dragon.scale.set(5, 5, 1);
    dragon.position.y = 1;
    scene.add(dragon);

    // Частицы фона (Звездная пыль)
    const starGeo = new THREE.BufferGeometry();
    const starCount = 3000;
    const posArray = new Float32Array(starCount * 3);
    for(let i=0; i<starCount*3; i++) posArray[i] = (Math.random()-0.5)*10;
    starGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
    const starMat = new THREE.PointsMaterial({ size: 0.005, color: 0xffd700 });
    const stars = new THREE.Points(starGeo, starMat);
    scene.add(stars);

    camera.position.z = 5;

    function animate() {
        requestAnimationFrame(animate);
        stars.rotation.y += 0.001;
        // Эффект дыхания дракона
        const time = Date.now() * 0.001;
        dragon.scale.set(5 + Math.sin(time)*0.1, 5 + Math.sin(time)*0.1, 1);
        renderer.render(scene, camera);
    }
    animate();

    // Логика ритуала
    function startRitual() {
        if(zenMusic.paused) {
            zenMusic.volume = 0;
            zenMusic.play();
            gsap.to(zenMusic, {volume: 0.5, duration: 3});
        }

        tg.HapticFeedback.impactOccurred('heavy');
        spawnCoins();

        // Имитация задержки "вращения"
        setTimeout(() => {
            showScroll("ТВОЕ ПОЛНОЕ ПРЕДСКАЗАНИЕ ИЗ БАЗЫ БОТА...");
        }, 2000);
    }

    function spawnCoins() {
        coinSound.currentTime = 0;
        coinSound.play();
        // Здесь можно добавить 3D монеты или спрайты
        tg.HapticFeedback.notificationOccurred('success');
    }

    function showScroll(text) {
        const scroll = document.getElementById('scroll-container');
        const content = document.getElementById('scroll-text');
        const seal = document.getElementById('seal');

        scroll.style.display = 'block';
        gsap.to(scroll, {scale: 1, duration: 1, ease: "back.out"});

        // Эффект печати текста (Каллиграфия)
        let i = 0;
        content.innerHTML = "";
        const timer = setInterval(() => {
            if(i < text.length) {
                content.innerHTML += text.charAt(i);
                i++;
            } else {
                clearInterval(timer);
                // Удар печатью
                gsap.to(seal, {opacity: 1, scale: 1, duration: 0.5, ease: "bounce.out", onComplete: () => {
                    tg.HapticFeedback.impactOccurred('heavy');
                    spawnCoins();
                }});
            }
        }, 30);
    }

    // Параллакс эффект для PS5 графики
    window.addEventListener('mousemove', (e) => {
        const x = (e.clientX / window.innerWidth - 0.5) * 0.5;
        const y = (e.clientY / window.innerHeight - 0.5) * 0.5;
        dragon.position.x = x;
        dragon.position.y = 1 - y;
    });
</script>
</body>
</html>
