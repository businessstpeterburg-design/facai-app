<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TON Temple • Eye of Eternity</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; }
        canvas { display: block; }
        #ui { position: absolute; bottom: 50px; width: 100%; text-align: center; z-index: 10; pointer-events: none; }
        .btn { 
            pointer-events: auto; padding: 20px 50px; 
            background: linear-gradient(135deg, #8a6d1d 0%, #d4af37 50%, #8a6d1d 100%); 
            border: 1px solid #ffec8b; border-radius: 50px; 
            color: white; font-weight: 900; font-size: 18px; 
            text-transform: uppercase; letter-spacing: 2px;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.4); 
            cursor: pointer; font-family: 'Segoe UI', Roboto, sans-serif;
            transition: transform 0.2s;
        }
        .btn:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <div id="ui"><button class="btn" onclick="triggerAction()">УЗНАТЬ СУДЬБУ</button></div>

    <script>
        let scene, camera, renderer, starGroup, blinkGroup, comet, dragon, bgSphere;
        let blinkPhases = [];

        window.onload = init;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.set(0, 0, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            document.body.appendChild(renderer.domElement);

            // --- 1. ФОН "ОКО БОГА" ---
            const texLoader = new THREE.TextureLoader();
            texLoader.load('background.jpg', (texture) => {
                const geometry = new THREE.SphereGeometry(500, 60, 40);
                const material = new THREE.MeshBasicMaterial({
                    map: texture,
                    side: THREE.BackSide,
                    transparent: true,
                    opacity: 0.9
                });
                bgSphere = new THREE.Mesh(geometry, material);
                scene.add(bgSphere);
            });

            // --- 2. СВЕТ ДЛЯ ПРЕМИУМ ЗОЛОТА ---
            const mainLight = new THREE.DirectionalLight(0xffffff, 2.5);
            mainLight.position.set(5, 10, 7);
            scene.add(mainLight);

            const sideLight = new THREE.PointLight(0xffaa00, 2);
            sideLight.position.set(-10, 5, 5);
            scene.add(sideLight);

            const ambient = new THREE.AmbientLight(0x404040, 1); 
            scene.add(ambient);

            // --- 3. ЗВЕЗДНАЯ ПЫЛЬ (ДРЕЙФ) ---
            const starTex = createStarTexture();
            starGroup = new THREE.Group();

            // Статичный слой (глубина)
            const staticGeo = new THREE.BufferGeometry();
            const staticPos = []; const staticCols = [];
            for(let i=0; i<3000; i++) {
                staticPos.push((Math.random()-0.5)*400, (Math.random()-0.5)*200, (Math.random()-0.5)*300);
                const b = 0.1 + Math.random() * 0.4;
                staticCols.push(b, b, b);
            }
            staticGeo.setAttribute('position', new THREE.Float32BufferAttribute(staticPos, 3));
            staticGeo.setAttribute('color', new THREE.Float32BufferAttribute(staticCols, 3));
            const sStars = new THREE.Points(staticGeo, new THREE.PointsMaterial({size: 0.6, map: starTex, transparent: true, vertexColors: true, blending: THREE.AdditiveBlending, depthWrite: false}));
            starGroup.add(sStars);

            // Мерцающий слой
            const blinkGeo = new THREE.BufferGeometry();
            const blinkPos = []; const blinkCols = [];
            for(let i=0; i<1000; i++) {
                blinkPos.push((Math.random()-0.5)*300, (Math.random()-0.5)*150, (Math.random()-0.5)*200);
                blinkPhases.push(Math.random() * Math.PI * 2);
                blinkCols.push(1, 1, 1);
            }
            blinkGeo.setAttribute('position', new THREE.Float32BufferAttribute(blinkPos, 3));
            blinkGeo.setAttribute('color', new THREE.Float32BufferAttribute(blinkCols, 3));
            blinkGroup = new THREE.Points(blinkGeo, new THREE.PointsMaterial({size: 1.2, map: starTex, transparent: true, vertexColors: true, blending: THREE.AdditiveBlending, depthWrite: false}));
            starGroup.add(blinkGroup);
            scene.add(starGroup);

            // --- 4. МЕДЛЕННАЯ КОМЕТА ---
            const cometGeo = new THREE.BufferGeometry().setFromPoints([new THREE.Vector3(0,0,0), new THREE.Vector3(-3, 3, 0)]);
            comet = new THREE.Line(cometGeo, new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0 }));
            scene.add(comet);

            // --- 5. ЗОЛОТОЙ ДРАКОН ---
            const loader = new THREE.GLTFLoader();
            loader.load('dragon.glb', (gltf) => {
                dragon = gltf.scene;
                dragon.traverse((n) => {
                    if (n.isMesh) {
                        n.material = new THREE.MeshStandardMaterial({
                            color: 0xffd700,
                            metalness: 1.0,
                            roughness: 0.15,
                            emissive: 0x221100
                        });
                    }
                });
                const box = new THREE.Box3().setFromObject(dragon);
                const scale = 8 / box.getSize(new THREE.Vector3()).length();
                dragon.scale.set(scale, scale, scale);
                dragon.position.set(0, -1, 0);
                scene.add(dragon);
            });

            window.addEventListener('resize', onResize);
            animate();
        }

        function createStarTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 64; canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.beginPath(); ctx.arc(32, 32, 6, 0, Math.PI*2); ctx.fill();
            ctx.strokeStyle = 'white'; ctx.lineWidth = 1.5;
            ctx.beginPath(); ctx.moveTo(32, 5); ctx.lineTo(32, 59); ctx.moveTo(5, 32); ctx.lineTo(59, 32); ctx.stroke();
            return new THREE.CanvasTexture(canvas);
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            const t = Date.now() * 0.001;

            // Движение фона (параллакс)
            if(bgSphere) bgSphere.rotation.y += 0.0003;

            // Движение звезд
            if(starGroup) starGroup.position.x += 0.005;

            // Индивидуальное мерцание
            if(blinkGroup) {
                const cols = blinkGroup.geometry.attributes.color.array;
                for(let i = 0; i < blinkPhases.length; i++) {
                    const b = 0.3 + Math.abs(Math.sin(t * 1.5 + blinkPhases[i])) * 0.7;
                    cols[i*3] = b; cols[i*3+1] = b; cols[i*3+2] = b;
                }
                blinkGroup.geometry.attributes.color.needsUpdate = true;
            }

            // Плавная комета
            if(comet && comet.material.opacity > 0) {
                comet.position.x += 0.25; comet.position.y -= 0.25;
                comet.material.opacity -= 0.007;
            } else if (Math.random() < 0.003) {
                comet.position.set((Math.random()-0.5)*60, 20, (Math.random()-0.5)*10);
                comet.material.opacity = 1;
            }

            // Анимация дракона
            if(dragon) {
                dragon.rotation.y += 0.005;
                dragon.position.y = -1 + Math.sin(t * 0.8) * 0.3;
            }

            renderer.render(scene, camera);
        }

        function triggerAction() {
            if(dragon) {
                // Эффект ускорения при нажатии
                dragon.rotation.y += 1.5;
            }
        }
    </script>
</body>
</html>
